1: #!/usr/bin/env python3
2: # -*- coding: utf-8 -*-
3: """
4: Created on Thu Jul 26 19:05:10 2018
5: 
6: @author: maximoskaliakatsos-papakostas
7: """
8: 
9: import music21 as m21
10: 
11: def generate_midi(sc, fileName="test_midi.mid", destination="/Users/maximoskaliakatsos-papakostas/Documents/python/miscResults/"):
12:     # we might want the take the name from uData information, e.g. the uData.input_id, which might preserve a unique key for identifying which file should be sent are response to which user
13:     # Ensure the stream has measures before MIDI export; music21's MIDI path calls expandRepeats()
14:     # which requires measure structures present on the stream
15:     s = sc
16:     if not isinstance(s, m21.stream.Score):
17:         tmpScore = m21.stream.Score()
18:         tmpScore.insert(0, s)
19:         s = tmpScore
20:     try:
21:         # create measures if missing; returns a new stream when inPlace=False
22:         s = s.makeMeasures(inPlace=False)
23:     except Exception:
24:         # proceed even if measure inference fails; MIDI export may still work for some streams
25:         pass
26:     mf = m21.midi.translate.streamToMidiFile(s)
27:     mf.open(destination + fileName, 'wb')
28:     mf.write()
29:     mf.close()
30: # end generate_midi
31: def generate_xml(sc, fileName="test_xml.xml", destination="/Users/maximoskaliakatsos-papakostas/Documents/python/miscResults/"):
32:     mf = m21.musicxml.m21ToXml.GeneralObjectExporter(sc)
33:     mfText = mf.parse().decode('utf-8')
34:     f = open(fileName, 'w')
35:     f.write(mfText.strip())
36:     f.close()
37: # end generate_xml
38: def generate_abc(sc, fileName="test_abc.mid", destination="/Users/maximoskaliakatsos-papakostas/Documents/python/miscResults/"):
39:     # write temporary xml file
40:     mf = m21.musicxml.m21ToXml.GeneralObjectExporter(sc)
41:     mfText = mf.parse().decode('utf-8')
42:     f = open(fileName+"xml", 'w')
43:     f.write(mfText.strip())
44:     f.close()
45:     xml2abc.main(fileName+"xml")
46: # end generate_abc
